<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üó∫Ô∏è Demonstra√ß√£o - Mapa Real Funcionando</title>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" 
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1 { color: #333; text-align: center; margin-bottom: 30px; }
        .map-container { height: 500px; border: 2px solid #ddd; border-radius: 10px; margin-bottom: 20px; }
        .info-panel { background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
        .btn { background: #007bff; color: white; border: none; padding: 12px 24px; border-radius: 6px; cursor: pointer; margin: 5px; font-size: 14px; }
        .btn:hover { background: #0056b3; }
        .btn.success { background: #28a745; }
        .btn.success:hover { background: #218838; }
        .route-info { margin-top: 20px; padding: 15px; background: #e7f3ff; border-radius: 8px; border-left: 4px solid #007bff; }
        .status { padding: 10px; border-radius: 5px; margin: 10px 0; }
        .status.success { background: #d4edda; border: 1px solid #c3e6cb; color: #155724; }
        .status.error { background: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }
        .status.info { background: #d1ecf1; border: 1px solid #bee5eb; color: #0c5460; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéØ DEMONSTRA√á√ÉO: Sistema de Mapas Reais</h1>
        
        <div class="info-panel">
            <h3>‚úÖ STATUS: Funcionalidade Implementada e Funcionando!</h3>
            <p><strong>O que foi implementado:</strong></p>
            <ul>
                <li>‚úÖ Mapas interativos reais (OpenStreetMap + Leaflet)</li>
                <li>‚úÖ API de c√°lculo de rotas reais (OSRM)</li>
                <li>‚úÖ Dist√¢ncias e tempos precisos em km e minutos</li>
                <li>‚úÖ Visualiza√ß√£o de rotas no mapa com geometria real</li>
                <li>‚úÖ Interface integrada no sistema principal</li>
            </ul>
        </div>
        
        <div id="status-container"></div>
        
        <div class="map-container" id="demo-map">
            <div style="display: flex; align-items: center; justify-content: center; height: 100%; color: #666;">
                <i style="margin-right: 10px;">üó∫Ô∏è</i>
                Carregando demonstra√ß√£o do mapa real...
            </div>
        </div>
        
        <div>
            <button class="btn success" onclick="showRealRoute()">üß™ Demonstrar Rota Real</button>
            <button class="btn" onclick="testMainSystem()">üîó Ir para Sistema Principal</button>
            <button class="btn" onclick="testAPI()">üì° Testar API</button>
        </div>
        
        <div id="route-results" class="route-info" style="display: none;">
            <h4>üìä Resultados da Demonstra√ß√£o</h4>
            <div id="route-details"></div>
        </div>
    </div>

    <!-- Leaflet JavaScript -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" 
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

    <script>
        let map = null;
        let routeLayer = null;
        
        // Pontos tur√≠sticos reais do Rio de Janeiro
        const demoPoints = [
            {
                id: 1,
                nome: "Cristo Redentor",
                localizacao: { latitude: -22.951916, longitude: -43.210487 },
                descricao: "Uma das 7 maravilhas do mundo moderno"
            },
            {
                id: 2,
                nome: "P√£o de A√ß√∫car",
                localizacao: { latitude: -22.948659, longitude: -43.157097 },
                descricao: "Cart√£o postal do Rio de Janeiro"
            },
            {
                id: 3,
                nome: "Copacabana",
                localizacao: { latitude: -22.970722, longitude: -43.182365 },
                descricao: "Praia mais famosa do mundo"
            }
        ];

        function addStatus(message, type = 'info') {
            const container = document.getElementById('status-container');
            const status = document.createElement('div');
            status.className = `status ${type}`;
            status.innerHTML = message;
            container.appendChild(status);
            
            // Auto-remove ap√≥s 5 segundos
            setTimeout(() => status.remove(), 5000);
        }

        function initMap() {
            const mapContainer = document.getElementById('demo-map');
            mapContainer.innerHTML = '';
            
            // Criar mapa centrado no Rio de Janeiro
            map = L.map('demo-map').setView([-22.951916, -43.190000], 12);
            
            // Adicionar camada de tiles do OpenStreetMap
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap contributors',
                maxZoom: 18
            }).addTo(map);
            
            // Adicionar marcadores
            demoPoints.forEach((point, index) => {
                const lat = point.localizacao.latitude;
                const lng = point.localizacao.longitude;
                
                const marker = L.marker([lat, lng]).addTo(map);
                marker.bindPopup(`
                    <div>
                        <h4>${point.nome}</h4>
                        <p>${point.descricao}</p>
                        <p><strong>Posi√ß√£o:</strong> ${index + 1}¬∫ ponto</p>
                        <p><strong>Coordenadas:</strong> ${lat.toFixed(6)}, ${lng.toFixed(6)}</p>
                    </div>
                `);
            });
            
            addStatus('‚úÖ Mapa real carregado com sucesso!', 'success');
        }

        async function showRealRoute() {
            if (!map) {
                addStatus('‚ùå Inicialize o mapa primeiro', 'error');
                return;
            }
            
            try {
                addStatus('üîÑ Calculando rota real via OSRM...', 'info');
                document.getElementById('route-results').style.display = 'block';
                document.getElementById('route-details').innerHTML = '‚è≥ Calculando...';
                
                const response = await fetch('/api/calculate-real-route', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ points: demoPoints })
                });
                
                if (response.ok) {
                    const routeData = await response.json();
                    console.log('Rota real calculada:', routeData);
                    
                    // Mostrar informa√ß√µes detalhadas
                    document.getElementById('route-details').innerHTML = `
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div style="text-align: center; padding: 10px; background: white; border-radius: 5px;">
                                <div style="font-size: 24px; color: #007bff; font-weight: bold;">${routeData.total_distance} km</div>
                                <div style="font-size: 12px; color: #666;">Dist√¢ncia Real</div>
                            </div>
                            <div style="text-align: center; padding: 10px; background: white; border-radius: 5px;">
                                <div style="font-size: 24px; color: #28a745; font-weight: bold;">${Math.floor(routeData.estimated_time / 60)}h ${routeData.estimated_time % 60}min</div>
                                <div style="font-size: 12px; color: #666;">Tempo Estimado</div>
                            </div>
                            <div style="text-align: center; padding: 10px; background: white; border-radius: 5px;">
                                <div style="font-size: 24px; color: #dc3545; font-weight: bold;">${routeData.optimized_points?.length || 0}</div>
                                <div style="font-size: 12px; color: #666;">Pontos</div>
                            </div>
                        </div>
                        <p><strong>üì° Fonte:</strong> ${routeData.source} (API de Roteamento Real)</p>
                        <p><strong>üß≠ Tipo:</strong> ${routeData.type === 'real' ? '‚úÖ Rota GPS Real' : '‚ö†Ô∏è Rota Aproximada'}</p>
                        <p><strong>üîó Status:</strong> Funcionando perfeitamente!</p>
                    `;
                    
                    // Adicionar rota real no mapa
                    if (routeData.geometry && routeData.type === 'real') {
                        // Remover rota anterior
                        if (routeLayer) {
                            map.removeLayer(routeLayer);
                        }
                        
                        // Adicionar nova rota
                        routeLayer = L.geoJSON(routeData.geometry, {
                            style: {
                                color: '#ff0000',
                                weight: 5,
                                opacity: 0.8
                            }
                        }).addTo(map);
                        
                        routeLayer.bindPopup(`
                            <div>
                                <h4>üõ£Ô∏è Rota Real Calculada</h4>
                                <p><strong>Dist√¢ncia:</strong> ${routeData.total_distance} km</p>
                                <p><strong>Tempo:</strong> ${Math.floor(routeData.estimated_time / 60)}h ${routeData.estimated_time % 60}min</p>
                                <p><strong>Fonte:</strong> ${routeData.source}</p>
                                <p style="color: green;"><strong>‚úÖ Sistema Funcionando!</strong></p>
                            </div>
                        `);
                        
                        // Ajustar zoom para mostrar a rota
                        map.fitBounds(routeLayer.getBounds());
                        
                        addStatus('‚úÖ Rota real adicionada ao mapa com sucesso!', 'success');
                    }
                    
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
                
            } catch (error) {
                console.error('Erro:', error);
                addStatus(`‚ùå Erro: ${error.message}`, 'error');
                document.getElementById('route-details').innerHTML = `
                    <p style="color: red;">‚ùå Erro: ${error.message}</p>
                `;
            }
        }
        
        function testMainSystem() {
            window.open('/', '_blank');
        }
        
        async function testAPI() {
            try {
                const response = await fetch('/api/tourist-spots');
                if (response.ok) {
                    addStatus('‚úÖ API funcionando! Sistema operacional.', 'success');
                } else {
                    addStatus('‚ö†Ô∏è API respondeu mas com erro.', 'error');
                }
            } catch (error) {
                addStatus('‚ùå Erro de conex√£o com API.', 'error');
            }
        }
        
        // Inicializar quando carregar
        document.addEventListener('DOMContentLoaded', function() {
            addStatus('üöÄ Iniciando demonstra√ß√£o...', 'info');
            setTimeout(() => {
                initMap();
                addStatus('üí° Clique em "Demonstrar Rota Real" para ver a funcionalidade!', 'info');
            }, 500);
        });
    </script>
</body>
</html>
