<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Seleção de Pontos</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }

        .test-container {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }

        .spot-card {
            background: #f5f5f5;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            cursor: pointer;
        }

        .spot-card.selected {
            background: #d4edda;
            border: 2px solid #28a745;
        }

        .external {
            border-left: 4px solid #007bff;
        }

        .selected-list {
            background: #fff3cd;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
        }

        button {
            padding: 10px 15px;
            margin: 5px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .log {
            background: #f8f9fa;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>

<body>
    <h1>🧪 Teste de Seleção de Pontos Turísticos</h1>

    <div class="test-container">
        <h2>Pontos Locais</h2>
        <div class="spot-card" data-spot-id="1" onclick="testToggleSpot('1')">
            <h3>Cristo Redentor</h3>
            <p>Ponto local ID: 1 (string)</p>
        </div>
        <div class="spot-card" data-spot-id="2" onclick="testToggleSpot('2')">
            <h3>Pão de Açúcar</h3>
            <p>Ponto local ID: 2 (string)</p>
        </div>
    </div>

    <div class="test-container">
        <h2>Pontos Externos</h2>
        <div class="spot-card external" data-spot-id="ext_123" onclick="testToggleSpot('ext_123')">
            <h3>Teatro alla Scala</h3>
            <p>Ponto externo ID: ext_123 (string)</p>
        </div>
        <div class="spot-card external" data-spot-id="ext_456" onclick="testToggleSpot('ext_456')">
            <h3>Museu do Louvre</h3>
            <p>Ponto externo ID: ext_456 (string)</p>
        </div>
    </div>

    <div class="test-container">
        <h2>Pontos Selecionados</h2>
        <div class="selected-list" id="selectedList">
            Nenhum ponto selecionado
        </div>
        <button onclick="clearSelection()">Limpar Seleção</button>
        <button onclick="showDebugInfo()">Debug Info</button>
    </div>

    <div class="test-container">
        <h2>Log de Eventos</h2>
        <div class="log" id="logContainer"></div>
        <button onclick="clearLog()">Limpar Log</button>
    </div>

    <script>
        // Simular dados para teste
        let selectedSpots = [];
        let availableSpots = [
            { id: '1', nome: 'Cristo Redentor', tipo: 'local' },
            { id: '2', nome: 'Pão de Açúcar', tipo: 'local' },
            { id: 'ext_123', nome: 'Teatro alla Scala', tipo: 'externo' },
            { id: 'ext_456', nome: 'Museu do Louvre', tipo: 'externo' }
        ];

        function log(message) {
            const logContainer = document.getElementById('logContainer');
            const timestamp = new Date().toLocaleTimeString();
            logContainer.innerHTML += `[${timestamp}] ${message}<br>`;
            logContainer.scrollTop = logContainer.scrollHeight;
            console.log(message);
        }

        function testToggleSpot(spotId) {
            log(`🎯 testToggleSpot chamado com ID: "${spotId}" (tipo: ${typeof spotId})`);

            // Buscar o ponto
            let spot = availableSpots.find(s => s.id == spotId);

            if (!spot) {
                log(`❌ Ponto não encontrado: ${spotId}`);
                return;
            }

            log(`✅ Ponto encontrado: ${spot.nome} (${spot.tipo})`);

            const index = selectedSpots.findIndex(s => s.id == spotId);

            if (index > -1) {
                // Remover da seleção
                selectedSpots.splice(index, 1);
                log(`➖ Ponto removido da seleção: ${spot.nome}`);
            } else {
                // Verificar limite de 5 pontos
                if (selectedSpots.length >= 5) {
                    log(`⚠️ Máximo de 5 pontos turísticos por rota`);
                    return;
                }

                // Adicionar à seleção
                selectedSpots.push(spot);
                log(`➕ Ponto adicionado à seleção: ${spot.nome}`);
            }

            updateVisualState();
        }

        function updateVisualState() {
            // Atualizar cards visuais
            document.querySelectorAll('.spot-card').forEach(card => {
                const spotId = card.dataset.spotId;
                const isSelected = selectedSpots.some(s => s.id === spotId);

                if (isSelected) {
                    card.classList.add('selected');
                } else {
                    card.classList.remove('selected');
                }
            });

            // Atualizar lista de selecionados
            const selectedList = document.getElementById('selectedList');
            if (selectedSpots.length === 0) {
                selectedList.innerHTML = 'Nenhum ponto selecionado';
            } else {
                selectedList.innerHTML = `
                    <strong>${selectedSpots.length}/5 pontos selecionados:</strong><br>
                    ${selectedSpots.map((spot, index) =>
                    `${index + 1}. ${spot.nome} (ID: ${spot.id}, Tipo: ${spot.tipo})`
                ).join('<br>')}
                `;
            }

            log(`📊 Estado atualizado: ${selectedSpots.length} pontos selecionados`);
        }

        function clearSelection() {
            selectedSpots = [];
            updateVisualState();
            log('🧹 Seleção limpa');
        }

        function showDebugInfo() {
            log('=== DEBUG INFO ===');
            log(`Total availableSpots: ${availableSpots.length}`);
            log(`Total selectedSpots: ${selectedSpots.length}`);
            log(`availableSpots IDs: [${availableSpots.map(s => s.id).join(', ')}]`);
            log(`selectedSpots IDs: [${selectedSpots.map(s => s.id).join(', ')}]`);
        }

        function clearLog() {
            document.getElementById('logContainer').innerHTML = '';
        }

        // Inicializar
        log('🚀 Teste de seleção inicializado');
        updateVisualState();
    </script>
</body>

</html>